{% extends 'layout.html' %}

{% block body %}
<script>
        async function fetchWeather(location){
            try{
                const response = await fetch(`api/${location}`);
                const data = await response.json();
                if (!response.ok) {
                    console.error(`Error: ${response.status} ${response.statusText}`);
                }
                console.log('Forecast:', data.forecast, 'Hourly:', data.hourly);
            } catch(error){
                console.error('There was a problem fetching data:', error);
            }
        }
         
    document.addEventListener("DOMContentLoaded", function() {       
        const hideElements = (selector) => {
            document.querySelectorAll(selector).forEach(element => {
                element.style.display = 'none';
            });
        };
        const showElements = (selector) => {
            document.querySelectorAll(selector).forEach(element => {
                element.style.display = 'block';
            });
        };

        const tempTab = document.querySelector('#tempLink');
        const popTab = document.querySelector('#popLink');
        const windTab = document.querySelector('#windLink');

   
        hideElements('.rainPic');
        hideElements('.windPic');
        hideElements('.hourPop');
        hideElements('.hourWind');

        // Show weatherPic and hourTemp initially
        showElements('.weatherPic');
        showElements('.hourTemp');

        const removeActiveClasses = () => {
            tempTab.classList.remove('active');
            popTab.classList.remove('active');
            windTab.classList.remove('active');
        };

        tempTab.addEventListener('click', function(){
            showElements('.weatherPic');
            showElements('.hourTemp');
            hideElements('.rainPic');
            hideElements('.hourPop');
            hideElements('.windPic');
            hideElements('.hourWind');
            removeActiveClasses();
            tempTab.classList.add('nav-link', 'active');

        });
        popTab.addEventListener('click', function(){
            showElements('.rainPic');
            showElements('.hourPop');
            hideElements('.weatherPic');
            hideElements('.hourTemp');
            hideElements('.windPic');
            hideElements('.hourWind');
            removeActiveClasses();
            popTab.classList.add('nav-link', 'active');

        });
        windTab.addEventListener('click', function(){
            showElements('.windPic');
            showElements('.hourWind');
            hideElements('.rainPic');
            hideElements('.hourPop');
            hideElements('.weatherPic');
            hideElements('.hourTemp');
            removeActiveClasses();
            windTab.classList.add('nav-link', 'active');
        });

        const location = document.querySelector('.big-icon').getAttribute('data-city');
        fetchWeather(location);
    });
</script>

    <div class="current-block">
        {% for loc in location %}
            <div class="all-current">
                <div class="current-weather">
                    <div class="icon-div">
                        <img data-city="{{ loc.city }}"class="big-icon" src="http://openweathermap.org/img/wn/{{ loc.icon }}.png" alt="Weather Icon">
                    </div>
                    <div class="temp-div">
                        <p class="big-temp"><b>{{ loc.temperature }}</b></p>
                        <p class="degree">°F</p>
                    </div>
                </div>
                    <p class="big-desc">{{ loc.weather_description }}</p>
            </div>
        {% endfor %}
    </div>

 
        <ul class="nav nav-underline">
            <li class="nav-item">
                <a id="tempLink" class="nav-link active" href="#">Temperature</a>
            </li>
            <li class="nav-item">
                <a id="popLink" class="nav-link" href="#">Precipitation</a>
            </li>
            <li class="nav-item">
                <a id="windLink" class="nav-link" href="#">Wind</a>
            </li>
        </ul>
        <div class="top-row">
            <div class="top-symbol">
                <i class="fa-regular fa-clock" style="color: rgba(255, 255, 255, 0.2);"></i>
            </div>
            <div class="top-title">
                <p class="title-top">HOURLY FORECAST</p>
            </div>
        </div>
        <div class="hourly-block">
            {% if hourly %}
                {% for hour in hourly %}
                    <div class="hourly-column">
                        <p><b>{{ hour.hourly_time }}</b></p>
                        <img class="rainPic" id="weather-icon" src="/static/Images/raindrop.png" id="weather-icon">
                        <img class="weatherPic" id="weather-icon" src="https://openweathermap.org/img/wn/{{ hour.hourly_symbol }}@2x.png" alt="Weather Icon">
                        <img class="windPic" id="weather-icon" src="{{hour.wind_symbol}}">
                        <p class="hourTemp">{{ hour.hourly_temp }} °</p>
                        <p class="hourPop">{{hour.hourly_precipitation}} %</p>
                        <p class="hourWind">{{ hour.wind_speed }} mph</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No hourly data available.</p>
            {% endif %}
        </div>
<div class="top-row">
    <div class="top-symbol">
        <i class="fa-regular fa-calendar-days" style="color: rgba(255, 255, 255, 0.2);"></i>
    </div>
    <div class="top-title">
        <p class="title-top">7-DAY FORECAST</p>
    </div>
</div>
<div class="weather-block">
        {% if forecast %}
            {% for fore in forecast %}
                <div data-bs-toggle="modal" data-bs-target="#modal_{{fore.forecast_day}}" class="forecast-row">
                    <div class="day-box">
                        <p><b>{{ fore.forecast_day }}</b></p>
                    </div>
                    <div class="weather-pic">
                        <img id="weather-icon" src="https://openweathermap.org/img/wn/{{ fore.forecast_symbol }}@2x.png" alt="Weather Icon">
                    </div>
                    <div class="weather-desc">
                        <p>{{ fore.forecast_name }}</p>
                    </div>
                    <div class="weather-temp">
                        <p>{{ fore.forecast_tempmax }}°</p>
                        <p class="tempMin">{{ fore.forecast_tempmin }}°</p>
                    </div>
                </div>
                <div id="modal_{{fore.forecast_day}}" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ fore.forecast_day }}, {{ fore.forecast_date }}</h5>
                        </div>
                        <div class="modal-body">
                            <div class="temp-values">
                                <img id="weather-icon" src="https://openweathermap.org/img/wn/{{ fore.forecast_symbol }}@2x.png" alt="Weather Icon">
                                <p class="temp-max">{{ fore.forecast_tempmax }}°</p>
                                <p class="temp-min">{{ fore.forecast_tempmin }}°</p>
                            </div>
                            <div class="daily-summary">
                                <p>Daily Summary</p>
                                <p><span>{{ fore.forecast_day }}</span>'s weather will have a low of <span>{{ fore.forecast_tempmin }}°</span> and a high of <span>{{ fore.forecast_tempmax }}°</span> and will consist of <span>{{ fore.forecast_name }}</span></p>
                            </div>
                            <div class="modal-elements">
                                <div class="modal-element">
                                    <p class="element-title">PRESSURE</p>
                                    <p>{{ fore.pressure }} inHg</p>
                                </div>
                                <div class="modal-element">
                                    <p class="element-title">HUMIDITY</p>
                                    <p>{{ fore.humidity }} %</p>
                                </div>
                                <div class="modal-element">
                                    <p class="element-title">PRECIPITATION</p>
                                    <p>{{ fore.precipitation }} %</p>
                                </div>
                                <div class="modal-element">
                                    <p class="element-title">RAINFALL</p>
                                    <p>{{ fore.rainfall }} mm</p>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                  </div>
            {% endfor %}
        {% else %}
            <p>No forecast data available</p>
        {% endif %}
</div>
{% endblock %}
